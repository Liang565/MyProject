import{h as i}from"./http.2f7338bd.js";import{p as s,m as v,M as m,i as d,E as F}from"./vendor.fd5a6943.js";const C=o=>{let t=s({total:0,current:1,pageSize:5});const p=e=>{a.value.page=e.current,t.value.current=e.current,u()};let a=s({limit:t.value.pageSize,page:1,where:s({})}),n=s();const u=async()=>{console.log("fetch");let e=await i.get(`${o}`,{params:{query:a.value}});n.value=e.data,t.value.total=e.total,n.value.length==0&&(a.value.page=a.value.page-1,t.value.current=t.value.current-1,u())};let r=s({add:!1,edit:!1,addSon:!1});const f=async(e,l)=>{l?await i.post(`${o}/${l}`,e):await i.post(`${o}`,e),v.success("\u6DFB\u52A0\u6210\u529F"),n.value.length==a.value.limit&&(t.value.total+1)%a.value.limit!=0&&(a.value.page=Math.floor(t.value.total/a.value.limit)+1,t.value.current=a.value.page),u(),r.value.add=!1},g=(e,l)=>{m.confirm({title:"\u662F\u5426\u786E\u8BA4\u5220\u9664\uFF1F",icon:d(F),content:d("div",{style:"color:red"},`\u662F\u5426\u5220\u9664:${l} \u6570\u636E\uFF1F`),async onOk(){await i.delete(`${o}/${e._id}`),v.success("\u5DF2\u5220\u9664"),u()},onCancel(){console.log("Cancel"),u()}})},h=async(e,l)=>{await i.put(`${o}/${e}`,l),v.success("\u5DF2\u4FEE\u6539"),u(),r.value.edit=!1};let c=s({});return{remove:g,viss:r,editOk:h,addOk:f,fetch:u,data:n,query:a,where:c,search:()=>{for(let e in c.value)c.value[e]==""&&delete c.value[e];a.value.page<1&&(a.value.page=1),a.value.where=c.value,u()},pagination:t,pageChange:p}};export{C};
