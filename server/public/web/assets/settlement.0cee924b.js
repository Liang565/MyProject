import{h as F}from"./http.d4512288.js";import{d as T,r as u,o as G,b as w,c as m,e as y,f as e,s as D,g as a,h as n,T as b,k as P,F as H,j as Q,w as r,t as p,y as R,i as j,x as B,D as Z,q as ee,u as te}from"./index.41ffedc4.js";import{_ as O}from"./iconPark.f90d97e7.js";/* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              */import{a as oe}from"./index.esm.8d852e6d.js";/* empty css              *//* empty css              */const se={class:"w-90vw"},ne={class:"flex justify-center items-center pt-5"},ae={key:0},ie={key:1},le=T({__name:"addressEdit",props:{type:String,addressObject:Object},emits:["end"],setup(I,{emit:C}){const o=I;let v=u({});const s=async i=>{console.log(i);const E=u({name:i.name,province:i.province,city:i.city,county:i.county,address:i.addressDetail,tel:i.tel,postalCode:i.areaCode,isDefault:i.isDefault});o.type=="add"?(console.log(E.value),await F.post("user-info",E.value),b.success("\u65B0\u589E\u6210\u529F~"),C("end",!1)):o.type=="edit"&&o.addressObject&&(await F.put(`user-info/${o.addressObject._id}`,E.value),b.success("\u4FEE\u6539\u6210\u529F~"),C("end",!1))};return G(()=>{o.type==="edit"&&o.addressObject&&(console.log(o.addressObject),v.value={name:o.addressObject.name,province:o.addressObject.province,city:o.addressObject.city,county:o.addressObject.county,addressDetail:o.addressObject.address,tel:o.addressObject.tel,postalCode:o.addressObject.postalCode,areaCode:o.addressObject.postalCode,isDefault:o.addressObject.isDefault})}),(i,E)=>{const f=w("van-address-edit");return m(),y("div",se,[e("div",ne,[o.type=="add"?(m(),y("div",ae,"\u65B0\u589E\u5730\u5740")):D("",!0),o.type=="edit"?(m(),y("div",ie,"\u4FEE\u6539\u5730\u5740")):D("",!0)]),e("div",null,[a(f,{"address-info":n(v),"area-list":n(oe),"show-postal":"","show-set-default":"","show-search-result":"","area-columns-placeholder":["\u8BF7\u9009\u62E9","\u8BF7\u9009\u62E9","\u8BF7\u9009\u62E9"],onSave:s},null,8,["address-info","area-list"])])])}}}),ce={class:"bg-gray-100 p-0 w-100vw h-100vh"},ue={class:"flex justify-between items-center pt-2"},de=e("div",{class:"mr-5 ml-2 flex justify-between items-center"},[e("div")],-1),re=e("div",{class:"pl-3"},"\u6211\u7684\u6536\u8D27\u5730\u5740",-1),ve={class:"w-16 h-7"},he={key:1},pe={class:"rounded flex justify-center pb-20"},_e={class:"w-full"},me=["onClick"],fe={class:"flex justify-start items-center"},ge={class:"custom-title"},ye={class:"text-lg"},be={key:0},ke=B("\u9ED8\u8BA4"),we=["onClick"],xe={class:"flex justify-between items-center"},Fe={class:"flex items-center"},Ee=["onClick"],$e=e("div",{class:"text-sm"},"\u9ED8\u8BA4\u5730\u5740",-1),Ce=["onClick"],De=e("div",{class:"text-sm"},"\u5220\u9664",-1),je=[De],Be={class:"flex justify-between items-center pl-3 p-3 w-full fixed bottom-0 bg-white"},ze=B(" \u6DFB\u52A0\u5730\u5740 "),Ae={key:0,class:"h-80vh"},Oe=T({__name:"myInfo",emits:["selectMyInfo"],setup(I,{emit:C}){const o=k=>{b.success("\u9009\u62E9\u6210\u529F~"),C("selectMyInfo",k)};let v=u([]);const s=async()=>{const k=await F.post("user-info/find");v.value=k,v.value.length===0&&b.fail("\u65E0\u6570\u636E~")};let i=u(!0);const E=()=>{i.value=!i.value};u({isDefault:!0});const f=async k=>{b.loading("~"),setTimeout(async()=>{await F.put(`user-info/${k}`,{isDefault:!0}),s()},1e3)},h=k=>{Z.confirm({title:"\u786E\u5B9A\u8981\u5220\u9664\u8BE5\u5730\u5740\u5417\uFF1F",cancelButtonText:"\u6211\u518D\u60F3\u60F3"}).then(async()=>{setTimeout(async()=>{await F.delete(`user-info/${k}`),s(),b.success("\u5DF2\u5220\u9664~")},1e3)}).catch(()=>{})};let d=u(!1);const x=()=>{d.value=!d.value,L.value="add"};let z=u({}),L=u();const q=k=>{d.value=!d.value,L.value="edit",z.value=k},S=()=>{N&&s()};let N=localStorage.getItem("token");return G(()=>{N&&s()}),(k,g)=>{const $=w("van-tag"),A=w("van-cell"),U=w("van-cell-group"),V=w("van-button"),W=w("van-popup");return m(),y("div",null,[e("div",ce,[e("div",ue,[de,re,e("div",ve,[e("button",{onClick:E},[n(i)?(m(),P(O,{key:0,type:"edit-two",theme:"outline",size:"24",spin:!1,fill:"#000000",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2})):D("",!0),n(i)?D("",!0):(m(),y("span",he,"\u5B8C\u6210"))])])]),e("div",pe,[e("div",_e,[(m(!0),y(H,null,Q(n(v),t=>(m(),y("div",{class:"py-1",onClick:c=>o(t)},[a(U,{inset:""},{default:r(()=>[a(A,null,{title:r(()=>[e("div",fe,[e("div",ge,[e("span",ye,p(t.name),1),e("span",null,p(t.tel),1)]),t.isDefault?(m(),y("div",be,[a($,{round:"",type:"danger"},{default:r(()=>[ke]),_:1})])):D("",!0)])]),label:r(()=>[e("div",null,p(t.province)+"/ "+p(t.city)+"/ "+p(t.county)+"/ "+p(t.address),1)]),"right-icon":r(()=>[e("button",{onClick:R(c=>q(t),["stop"])},[n(i)?(m(),P(O,{key:0,type:"edit",theme:"outline",size:"20  ",spin:!1,fill:"#000000",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2})):D("",!0)],8,we)]),_:2},1024),n(i)?D("",!0):(m(),P(A,{key:0},{default:r(()=>[e("div",xe,[e("div",Fe,[e("div",null,[e("button",{onClick:R(c=>f(t._id),["stop"])},[a(O,{type:"round",theme:"outline",size:"18",spin:!1,fill:"#000000",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2})],8,Ee)]),$e]),e("div",null,[e("button",{onClick:R(c=>h(t._id),["stop"])},je,8,Ce)])])]),_:2},1024))]),_:2},1024)],8,me))),256))])]),e("div",Be,[a(V,{type:"primary",size:"large",icon:"plus",round:"",onClick:x},{default:r(()=>[ze]),_:1})])]),e("div",null,[a(W,{round:"",closeable:!0,show:n(d),"onUpdate:show":g[1]||(g[1]=t=>j(d)?d.value=t:d=t),position:"bottom",onClose:g[2]||(g[2]=t=>S())},{default:r(()=>[n(d)?(m(),y("div",Ae,[a(le,{type:n(L),addressObject:n(z),onEnd:g[0]||(g[0]=t=>{j(d)?d.value=t:d=t})},null,8,["type","addressObject"])])):D("",!0)]),_:1},8,["show"])])])}}}),Ie={class:"flex justify-between w-90vw bg-gray-50 p-3 rounded-lg"},Le={class:"flex items-center"},Ne={class:"text-base"},Ve={class:"pr-2"},Te={class:"flex items-center"},Se=T({__name:"info",emits:["selectInfo"],setup(I,{emit:C}){let o=u({address:"",city:"",county:"",id:"",isDefault:!0,name:"",postalCode:"",province:"",tel:"",user:"",_id:""}),v=u(!1);const s=()=>{C("selectInfo",o.value)},i=()=>{v.value=!0};return(async()=>{const f=await F.post("user-info/find");for(let h in f)if(f[h].isDefault){o.value=f[h];return}b.fail("\u65E0\u6570\u636E~")})(),ee(o,(f,h)=>{s()}),(f,h)=>{const d=w("van-action-sheet");return m(),y("div",null,[e("div",{class:"flex justify-center py-3",onClick:i},[e("div",Ie,[e("div",Le,[a(O,{type:"local-two",theme:"filled",size:"35",spin:!1,fill:"#4a90e2",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2})]),e("div",null,[e("div",Ne,p(n(o).province)+"/ "+p(n(o).city)+"/ "+p(n(o).county)+"/ "+p(n(o).address),1),e("div",null,[e("span",Ve,p(n(o).name),1),e("span",null,p(n(o).tel),1)])]),e("div",Te,[a(O,{type:"right",theme:"outline",size:"24",spin:!1,fill:"#000000",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2})])])]),e("div",null,[a(d,{show:n(v),"onUpdate:show":h[1]||(h[1]=x=>j(v)?v.value=x:v=x),title:"\u9009\u62E9\u5730\u5740"},{default:r(()=>[a(Oe,{onSelectMyInfo:h[0]||(h[0]=x=>{j(o)?o.value=x:o=x})})]),_:1},8,["show"])])])}}}),Ue=B(" \u786E\u8BA4\u8BA2\u5355 "),We={class:"pb-16"},Me={class:"flex justify-center"},Pe={class:"w-90vw mb-3 bg-gray-100 rounded-lg"},Re={class:"text-xl w-40 overflow-hidden text-ellipsis whitespace-nowrap"},qe={class:"w-44 overflow-hidden text-ellipsis whitespace-nowrap"},Je={class:"flex justify-end items-center pl-3 p-3 w-full fixed bottom-0 bg-white"},Ke={class:"flex items-center mx-2"},Ye={class:"text-sm text-neutral-600"},Ge=B(" \u5408\u8BA1\uFF1A "),He={class:"text-red-500"},Qe={class:"ml-3"},Xe=B("\u63D0\u4EA4\u8BA2\u5355"),Ze={class:"h-70vh bg-gray-50 py-5"},et={class:"flex justify-center pb-20 pt-40"},tt={class:"w-80vw"},ot=B("\u786E\u5B9A"),st={class:"h-70vh bg-gray-50 py-5"},nt=B(" \u6CA1\u6709\u63A5\u652F\u4ED8\u5B9D\u6C99\u76D2\uFF0C\u751F\u6210\u7684\u8BA2\u5355\u72B6\u6001\u90FD\u662F\u672A\u652F\u4ED8\u7684\u3002 \u76F4\u63A5\u70B9\u51FB\u786E\u5B9A\u3002 "),at={class:"flex justify-center pb-20 pt-40"},it={class:"w-80vw"},lt=B("\u786E\u5B9A"),kt=T({__name:"settlement",props:{model:{type:String,default:"1"}},setup(I){const C=I,o=te();let v=u(),s=u([]),i=u(0),E=u(0),f=u(),h=u(!1),d=u(!1),x=u([]),z=!1;const L=()=>{o.go(-1)};v.value=JSON.parse(C.model),i.value=v.value.total,d.value=v.value.key==="cart",(async t=>{E.value=t.length;for(let c in t){const _=await F.get(`commoditys/${t[c].commodity}`);d.value?s.value.push({id:_._id,image:_.image[0].url,name:_.commodityName,introduce:_.commodityIntroduce,price:_.price,kucun:_.commodityNum,num:t[c].goodsNum,remarks:"",key:c,cartId:t[c].cartId,shop:_.shop}):s.value.push({id:_._id,image:_.image[0].url,name:_.commodityName,introduce:_.commodityIntroduce,price:_.price,kucun:_.commodityNum,num:t[c].goodsNum,remarks:"",key:c,shop:_.shop})}})(v.value.model);const S=()=>{b.loading({message:"\u52A0\u8F7D\u4E2D...",forbidClick:!0}),setTimeout(async()=>{for(let t in s.value){const c=await F.post("orders",{user:f.value.user,commodity:s.value[t].id,goodsNum:s.value[t].num,money:s.value[t].num*s.value[t].price,userInfo:f.value.id,remarks:s.value[t].remarks,state:"\u672A\u652F\u4ED8",shop:s.value[t].shop});x.value.push(c._id),d.value&&await F.delete(`shopping-cart/${s.value[t].cartId}`),await F.put(`commoditys/${s.value[t].id}`,{commodityNum:s.value[t].kucun-s.value[t].num})}b.success("\u521B\u5EFA\u8BA2\u5355\u6210\u529F~"),console.log("\u63D0\u4EA4"),z=!1,h.value=!0},2e3)},N=()=>{b.loading({message:"\u52A0\u8F7D\u4E2D...",forbidClick:!0}),setTimeout(async()=>{for(let t in x.value)await F.put(`/orders/${x.value[t]}`,{state:"\u5F85\u53D1\u8D27"});b.success("\u652F\u4ED8\u6210\u529F~"),z=!0,h.value=!1},2e3)},k=()=>{z?(b.success("\u652F\u4ED8\u6210\u529F~"),o.go(-1)):(b.fail("\u672A\u652F\u4ED8~"),o.push("/my/pending"))};let g=u(!1),$=u(""),A=u("");const U=t=>{g.value=!0,$.value=t.remarks,A.value=t.key},V=()=>{$.value="",A.value=""},W=()=>{s.value[A.value].remarks=$.value,g.value=!1,V()};return(t,c)=>{const _=w("van-card"),J=w("van-field"),M=w("van-button"),X=w("van-cell-group"),K=w("van-action-sheet");return m(),y("div",null,[e("div",null,[e("button",{onClick:L,class:"flex items-center pl-5 pt-2"},[a(O,{type:"back",theme:"outline",size:"24",spin:!1,fill:"#000000",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2}),Ue])]),e("div",We,[e("div",null,[a(Se,{onSelectInfo:c[0]||(c[0]=l=>{j(f)?f.value=l:f=l})})]),(m(!0),y(H,null,Q(n(s),l=>(m(),y("div",Me,[e("div",Pe,[a(_,{num:l.num,price:l.price,thumb:l.image,class:"rounded-t-lg"},{title:r(()=>[e("div",Re,p(l.name),1)]),desc:r(()=>[e("div",qe,p(l.introduce),1)]),footer:r(()=>[e("div",null,"\u5408\u8BA1\uFFE5"+p(l.price*l.num),1)]),_:2},1032,["num","price","thumb"]),a(J,{modelValue:l.remarks,"onUpdate:modelValue":Y=>l.remarks=Y,label:"\u8BA2\u5355\u5907\u6CE8\uFF1A",readonly:"",placeholder:"\u65E0\u5907\u6CE8","right-icon":"arrow",onClick:Y=>U(l),class:"mb-1"},null,8,["modelValue","onUpdate:modelValue","onClick"])])]))),256))]),e("div",Je,[e("div",Ke,[e("div",null,[e("span",Ye,"\u5171\u8BA1"+p(n(E))+"\u4EF6",1),Ge,e("span",He,"\uFFE5"+p(n(i)),1)]),e("div",Qe,[a(M,{round:"",type:"primary",onClick:S},{default:r(()=>[Xe]),_:1})])])]),e("div",null,[a(K,{show:n(g),"onUpdate:show":c[2]||(c[2]=l=>j(g)?g.value=l:g=l),title:"\u8BA2\u5355\u5907\u6CE8",onClose:V},{default:r(()=>[e("div",Ze,[a(X,{inset:""},{default:r(()=>[a(J,{modelValue:n($),"onUpdate:modelValue":c[1]||(c[1]=l=>j($)?$.value=l:$=l),rows:"5",autosize:"",type:"textarea",maxlength:"200",placeholder:"\u8BF7\u8F93\u5165\u7559\u8A00","show-word-limit":""},null,8,["modelValue"])]),_:1}),e("div",et,[e("div",tt,[a(M,{plain:"",type:"primary",size:"large",onClick:W},{default:r(()=>[ot]),_:1})])])])]),_:1},8,["show"])]),e("div",null,[a(K,{show:n(h),"onUpdate:show":c[3]||(c[3]=l=>j(h)?h.value=l:h=l),title:"\u652F\u4ED8",onClose:k},{default:r(()=>[e("div",st,[nt,e("div",at,[e("div",it,[a(M,{plain:"",type:"primary",size:"large",onClick:N},{default:r(()=>[lt]),_:1})])])])]),_:1},8,["show"])])])}}});export{kt as default};
