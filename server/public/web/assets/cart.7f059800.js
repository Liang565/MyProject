import{d as Z,u as ee,r as p,q as te,o as oe,a as se,b as g,c as s,e as r,f as t,h as e,g as i,s as n,t as v,k as b,w as c,i as A,v as ue,x as F,T as d,F as le,j as ie,y as $}from"./index.fcff6f00.js";import{C as ne}from"./curd.e2c0bef0.js";/* empty css              *//* empty css              *//* empty css              *//* empty css              */import{h as G}from"./http.ad2d7282.js";/* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              */import{_ as y}from"./iconPark.dc992ce0.js";import{_ as ae}from"./loginDialog.8326471a.js";/* empty css              */const re={class:"flex justify-between mb-5 ml-5 mt-2"},ce={class:"flex w-16"},de={key:0,class:"mr-2"},me={key:1},_e={class:"text-xl"},pe=F(" \u8D2D\u7269\u8F66"),fe={key:0},he={class:"w-16 h-7"},ve={key:1},ke={class:"pb-28"},ge={class:"w-90vw"},ye={class:"text-xl w-40 overflow-hidden text-ellipsis whitespace-nowrap"},Fe={key:0,class:"text-red-500"},xe={class:"w-40 overflow-hidden text-ellipsis whitespace-nowrap"},Ce={class:"flex"},be=t("div",{class:"text-sm mt-1"},"\u5168\u9009",-1),we={key:0,class:"flex items-center mx-2"},De={class:"text-sm"},Ee=F(" \u5408\u8BA1\uFF1A "),Be=t("span",{class:"text-sm text-red-500"}," \uFFE5 ",-1),Ne={class:"text-xl text-red-500"},Ae={class:"ml-3"},je=F("\u7ED3\u7B97"),Le={key:1,class:"flex items-center"},Ve=F(" \u5DF2\u9009\uFF1A"),ze={class:"mx-2"},Se=F("\u5220\u9664"),Ze=Z({__name:"cart",setup($e){let x=localStorage.getItem("token");const w=ee();let C=p(!1);const{fetch:D,search:Ge,data:j,query:E,goGoods:T,total:L,totalSum:W,removeCart:V}=ne("shopping-cart"),q=async l=>{l.commodity.commodityNum<l.goodsNum?d.fail("\u5E93\u5B58\u4E0D\u8DB3~"):l.goodsNum===1?d.fail("\u5546\u54C1\u4E0D\u80FD\u518D\u51CF\u5C11\u4E86~"):(d.loading({message:"\u52A0\u8F7D\u4E2D...",forbidClick:!0,duration:500}),G.put(`shopping-cart/${l._id}`,{goodsNum:l.goodsNum-1}),setTimeout(()=>{E.value.where={user:k},D()},500))},I=async l=>{d.loading({message:"\u52A0\u8F7D\u4E2D...",forbidClick:!0,duration:500}),l.commodity.commodityNum<l.goodsNum?d.fail("\u5E93\u5B58\u4E0D\u8DB3~"):(G.put(`shopping-cart/${l._id}`,{goodsNum:l.goodsNum+1}),setTimeout(()=>{E.value.where={user:k},D()},500))},M=()=>{w.go(-2)},R=()=>{w.push("/")};let h=p(!0);const U=()=>{x?(h.value=!h.value,u.value=[]):d.fail("\u5F53\u524D\u8EAB\u4EFD\u4E3A\u6E38\u5BA2\uFF0C\u8BF7\u767B\u5F55\uFF01")};let u=p([]),f=p(!1);const z=p();let B=p(0),S=p([]),O="flex justify-between items-center pl-3 p-3 w-full fixed bottom-12 bg-white",H="flex justify-between items-center pl-3 p-3 w-full fixed bottom-0 bg-white",k=localStorage.getItem("userid"),m=p(!1);const J=()=>{if(!x){d.fail("\u5F53\u524D\u8EAB\u4EFD\u4E3A\u6E38\u5BA2\uFF0C\u8BF7\u767B\u5F55\uFF01");return}f.value=!f.value,z.value.toggleAll(f.value)};te(u,(l,a)=>{W(u.value).then(_=>{B.value=_.totalSum,S.value=_.goodsOrder}),u.value.length==j.value.length?f.value=!0:f.value=!1});const K=()=>{if(!x){d.fail("\u5F53\u524D\u8EAB\u4EFD\u4E3A\u6E38\u5BA2\uFF0C\u8BF7\u767B\u5F55\uFF01");return}if(u.value.length===0){d.fail("\u6CA1\u6709\u9009\u62E9\u5546\u54C1~");return}w.push({path:"/settlement",query:{model:JSON.stringify(S.value),total:B.value,key:"cart"}})};return oe(()=>{x?(E.value.where={user:k},D(),se().meta.key=="cart1"&&(C.value=!0)):m.value=!0}),(l,a)=>{const _=g("van-button"),P=g("van-card"),Q=g("van-swipe-cell"),X=g("van-checkbox"),Y=g("van-checkbox-group");return s(),r("div",null,[t("div",re,[t("div",ce,[e(C)?(s(),r("div",de,[t("button",{onClick:M},[i(y,{type:"back",theme:"outline",size:"24",spin:!1,fill:"#000000",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2})])])):n("",!0),e(C)?(s(),r("div",me,[t("button",{onClick:R},[i(y,{type:"home",theme:"outline",size:"24",spin:!1,fill:"#000000",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2})])])):n("",!0)]),t("div",_e,[pe,e(L)?(s(),r("span",fe,"("+v(e(L))+")",1)):n("",!0)]),t("div",he,[t("button",{onClick:U},[e(h)?(s(),b(y,{key:0,type:"edit-two",theme:"outline",size:"24",spin:!1,fill:"#000000",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2})):n("",!0),e(h)?n("",!0):(s(),r("span",ve,"\u5B8C\u6210"))])])]),t("div",ke,[i(Y,{modelValue:e(u),"onUpdate:modelValue":a[0]||(a[0]=o=>A(u)?u.value=o:u=o),ref_key:"checkboxGroup",ref:z,class:"flex justify-center"},{default:c(()=>[t("div",ge,[(s(!0),r(le,null,ie(e(j),o=>(s(),b(X,{name:o._id,class:"bg-gray-50 rounded-lg flex justify-between mb-3"},{default:c(()=>[i(Q,null,{right:c(()=>[i(_,{square:"",text:"\u5220\u9664",type:"danger",class:"delete-button",onClick:N=>e(V)([o._id],e(k))},null,8,["onClick"])]),default:c(()=>[i(P,{num:o.goodsNum,price:o.goodsNum*o.commodity.price,thumb:o.commodity.image[0].url,onClick:N=>e(T)(o.commodity)},{title:c(()=>[t("div",ye,v(o.commodity.commodityName),1)]),desc:c(()=>[o.commodity.commodityNum<o.goodsNum?(s(),r("div",Fe," \u5E93\u5B58\u4E0D\u8DB3 ")):n("",!0),t("div",xe,v(o.commodity.commodityIntroduce),1)]),footer:c(()=>[i(_,{size:"small",icon:"minus",color:"rgb(59, 130, 246)",onClick:$(N=>q(o),["stop"])},null,8,["onClick"]),i(_,{size:"small",icon:"plus",color:"rgb(59, 130, 246)",onClick:$(N=>I(o),["stop"])},null,8,["onClick"])]),_:2},1032,["num","price","thumb","onClick"])]),_:2},1024)]),_:2},1032,["name"]))),256))])]),_:1},8,["modelValue"])]),t("div",{class:ue(e(C)?e(H):e(O))},[t("div",null,[t("button",{onClick:J},[t("div",Ce,[e(f)?n("",!0):(s(),b(y,{key:0,type:"full-selection",theme:"outline",size:"24",spin:!1,fill:"#000000",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2})),e(f)?(s(),b(y,{key:1,type:"full-selection",theme:"filled",size:"24",spin:!1,fill:"#4a90e2",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2})):n("",!0),be])])]),e(h)?(s(),r("div",we,[t("div",null,[t("span",De," \u5DF2\u9009\uFF1A"+v(e(u).length),1),Ee,Be,t("span",Ne,v(e(B)),1)]),t("div",Ae,[i(_,{round:"",type:"primary",onClick:K},{default:c(()=>[je]),_:1})])])):n("",!0),e(h)?n("",!0):(s(),r("div",Le,[t("div",null,[Ve,t("span",null,v(e(u).length),1)]),t("div",ze,[i(_,{round:"",type:"primary",onClick:a[1]||(a[1]=o=>e(V)(e(u),e(k)))},{default:c(()=>[Se]),_:1})])]))],2),t("div",null,[i(ae,{showDialog:e(m),"onUpdate:showDialog":a[2]||(a[2]=o=>A(m)?m.value=o:m=o),onGetShow:a[3]||(a[3]=o=>{A(m)?m.value=o:m=o})},null,8,["showDialog"])])])}}});export{Ze as default};
