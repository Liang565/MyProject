import{h as f}from"./http.ad2d7282.js";import{d as q,u as O,r as l,a as J,b as y,c as B,e as C,f as o,g as i,i as w,F as K,j as W,h as p,t as g,w as n,x as _,T as v}from"./index.fcff6f00.js";import{_ as G}from"./iconPark.dc992ce0.js";import{_ as H}from"./info.e6227567.js";/* empty css              *//* empty css              */import"./index.esm.8d852e6d.js";/* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              */const M=_(" \u786E\u8BA4\u8BA2\u5355 "),Q={class:"pb-16"},X={class:"flex justify-center"},Y={class:"w-90vw mb-3 bg-gray-100 rounded-lg"},Z={class:"text-xl w-40 overflow-hidden text-ellipsis whitespace-nowrap"},ee={class:"w-44 overflow-hidden text-ellipsis whitespace-nowrap"},te={class:"flex justify-end items-center pl-3 p-3 w-full fixed bottom-0 bg-white"},oe={class:"flex items-center mx-2"},se={class:"text-sm text-neutral-600"},ue=_(" \u5408\u8BA1\uFF1A "),ae={class:"text-red-500"},le={class:"ml-3"},ie=_("\u63D0\u4EA4\u8BA2\u5355"),ne={class:"h-70vh bg-gray-50 py-5"},re={class:"flex justify-center pb-20 pt-40"},de={class:"w-80vw"},ce=_("\u786E\u5B9A"),me={class:"h-70vh bg-gray-50 py-5"},pe=_(" \u8BF7\u76F4\u63A5\u70B9\u51FB\u786E\u5B9A\u3002 "),ve={class:"flex justify-center pb-20 pt-40"},_e={class:"w-80vw"},he=_("\u786E\u5B9A"),Ie=q({__name:"settlement",props:{model:{type:String,default:"1"}},setup(fe){const k=O();let r=l(),a=l([]),D=l(0),N=l(0),h=l(),c=l(!1),F=l(!1),x=l([]),A=!1;const S=()=>{k.go(-1)};r.value=J().query,r.value.model=JSON.parse(r.value.model),console.log("\u7ED3\u7B97",r.value),D.value=r.value.total,F.value=r.value.key==="cart",(async e=>{N.value=e.length;for(let s in e){const u=await f.get(`commoditys/${e[s].commodity}`);F.value?a.value.push({id:u._id,image:u.image[0].url,name:u.commodityName,introduce:u.commodityIntroduce,price:u.price,kucun:u.commodityNum,num:e[s].goodsNum,remarks:"",key:s,cartId:e[s].cartId,shop:u.shop}):a.value.push({id:u._id,image:u.image[0].url,name:u.commodityName,introduce:u.commodityIntroduce,price:u.price,kucun:u.commodityNum,num:e[s].goodsNum,remarks:"",key:s,shop:u.shop})}})(r.value.model);const U=()=>{v.loading({message:"\u52A0\u8F7D\u4E2D...",forbidClick:!0}),setTimeout(async()=>{for(let e in a.value){const s=await f.post("orders",{user:h.value.user,commodity:a.value[e].id,goodsNum:a.value[e].num,money:a.value[e].num*a.value[e].price,userInfo:h.value.id,remarks:a.value[e].remarks,state:"\u672A\u652F\u4ED8",shop:a.value[e].shop});x.value.push(s._id),F.value&&await f.delete(`shopping-cart/${a.value[e].cartId}`),await f.put(`commoditys/${a.value[e].id}`,{commodityNum:a.value[e].kucun-a.value[e].num})}v.success("\u521B\u5EFA\u8BA2\u5355\u6210\u529F~"),console.log("\u63D0\u4EA4"),A=!1,c.value=!0},2e3)},z=()=>{v.loading({message:"\u52A0\u8F7D\u4E2D...",forbidClick:!0}),setTimeout(async()=>{for(let e in x.value)await f.put(`/orders/${x.value[e]}`,{state:"\u5F85\u53D1\u8D27"});v.success("\u652F\u4ED8\u6210\u529F~"),A=!0,c.value=!1},2e3)},P=()=>{A?(v.success("\u652F\u4ED8\u6210\u529F~"),k.go(-1)):(v.fail("\u672A\u652F\u4ED8~"),k.push({path:"/my/order-index",query:{state:"\u672A\u652F\u4ED8"}}))};let m=l(!1),d=l(""),E=l("");const R=e=>{m.value=!0,d.value=e.remarks,E.value=e.key},V=()=>{d.value="",E.value=""},$=()=>{a.value[E.value].remarks=d.value,m.value=!1,V()};return(e,s)=>{const u=y("van-card"),I=y("van-field"),b=y("van-button"),L=y("van-cell-group"),T=y("van-action-sheet");return B(),C("div",null,[o("div",null,[o("button",{onClick:S,class:"flex items-center pl-5 pt-2"},[i(G,{type:"back",theme:"outline",size:"24",spin:!1,fill:"#000000",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2}),M])]),o("div",Q,[o("div",null,[i(H,{onSelectInfo:s[0]||(s[0]=t=>{w(h)?h.value=t:h=t})})]),(B(!0),C(K,null,W(p(a),t=>(B(),C("div",X,[o("div",Y,[i(u,{num:t.num,price:t.price,thumb:t.image,class:"rounded-t-lg"},{title:n(()=>[o("div",Z,g(t.name),1)]),desc:n(()=>[o("div",ee,g(t.introduce),1)]),footer:n(()=>[o("div",null,"\u5408\u8BA1\uFFE5"+g(t.price*t.num),1)]),_:2},1032,["num","price","thumb"]),i(I,{modelValue:t.remarks,"onUpdate:modelValue":j=>t.remarks=j,label:"\u8BA2\u5355\u5907\u6CE8\uFF1A",readonly:"",placeholder:"\u65E0\u5907\u6CE8","right-icon":"arrow",onClick:j=>R(t),class:"mb-1"},null,8,["modelValue","onUpdate:modelValue","onClick"])])]))),256))]),o("div",te,[o("div",oe,[o("div",null,[o("span",se,"\u5171\u8BA1"+g(p(N))+"\u4EF6",1),ue,o("span",ae,"\uFFE5"+g(p(D)),1)]),o("div",le,[i(b,{round:"",type:"primary",onClick:U},{default:n(()=>[ie]),_:1})])])]),o("div",null,[i(T,{show:p(m),"onUpdate:show":s[2]||(s[2]=t=>w(m)?m.value=t:m=t),title:"\u8BA2\u5355\u5907\u6CE8",onClose:V},{default:n(()=>[o("div",ne,[i(L,{inset:""},{default:n(()=>[i(I,{modelValue:p(d),"onUpdate:modelValue":s[1]||(s[1]=t=>w(d)?d.value=t:d=t),rows:"5",autosize:"",type:"textarea",maxlength:"200",placeholder:"\u8BF7\u8F93\u5165\u7559\u8A00","show-word-limit":""},null,8,["modelValue"])]),_:1}),o("div",re,[o("div",de,[i(b,{plain:"",type:"primary",size:"large",onClick:$},{default:n(()=>[ce]),_:1})])])])]),_:1},8,["show"])]),o("div",null,[i(T,{show:p(c),"onUpdate:show":s[3]||(s[3]=t=>w(c)?c.value=t:c=t),title:"\u652F\u4ED8",onClose:P},{default:n(()=>[o("div",me,[pe,o("div",ve,[o("div",_e,[i(b,{plain:"",type:"primary",size:"large",onClick:z},{default:n(()=>[he]),_:1})])])])]),_:1},8,["show"])])])}}});export{Ie as default};
