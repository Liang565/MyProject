import{u as y}from"./user.dc7ceeb0.js";import{h as r,T as c}from"./http.b40e557a.js";import{D as h}from"./function-call.a2ba94a4.js";import{q as l}from"./reactivity.esm-bundler.f180a2dc.js";const w=i=>{const g=y();let m=l(),f=l(),t=l({limit:0,page:1,where:l()});const n=async()=>{const o=await r.get(`/${i}`,{params:{query:t.value}});if(o.total==0)c.fail("\u65E0\u6570\u636E~"),m.value=[];else{const u=JSON.stringify(t.value);g.push({query:{query1:u}}),m.value=o.data,f.value=o.total}};return{fetch:n,search:async()=>{console.log(t),n()},data:m,query:t,goGoods:o=>{g.push(`/goods/${o._id}`)},total:f,totalSum:async o=>{let u=0,e=[];for(let a in o){const s=await r.put(`/${i}/${o[a]}`),d=await r.put(`commoditys/${s.commodity}`);s.goodsNum>d.commodityNum?c.loading(`\u5546\u54C1\uFF1A${d.commodityName}\u5E93\u5B58\u4E0D\u8DB3~`):(e.push({goodsNum:s.goodsNum,commodity:s.commodity,cartId:o[a]}),u=u+s.goodsNum*d.price)}return{totalSum:u,goodsOrder:e}},removeCart:(o,u)=>{let e=o.length;e===0?c.fail("\u60A8\u8FD8\u6CA1\u6709\u9009\u62E9\u5546\u54C1~"):h.confirm({title:`\u5DF2\u9009\u62E9${e}\u4E2A\u5546\u54C1`,message:"\u786E\u5B9A\u8981\u5220\u9664\u5417\uFF1F",cancelButtonText:"\u6211\u518D\u60F3\u60F3"}).then(async()=>{for(let a in o)console.log(o[a]),await r.delete(`${i}/${o[a]}`);t.value.where={user:u},n(),c.success("\u5DF2\u5220\u9664~")}).catch(()=>{})}}};export{w as C};
