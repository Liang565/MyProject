import{h as c}from"./http.72fb258c.js";import{d as Q,g as i,h as W,r as v,o as X,j as Y,p,k as t,w as o,l as n,F as Z,m as k,n as U,y as m,t as A,L as ee,N as te}from"./vendor.21c9141e.js";const ae={class:"mt-2 flex"},le=m("\u65B0\u589E"),ue={class:"ml-5"},ne=m("\u641C\u7D22"),oe={class:"mt-4 h-70vh overflow-y-auto"},se=m("\u65B0\u589E\u5B50\u7C7B"),ie=m("\u4FEE\u6539"),de=m("\u5220\u9664"),pe=Q({setup(re){let _=i();i([{}]);let C=i({total:999,current:1,pageSize:999}),y=i({limit:C.value.pageSize,page:1,where:{parent:{$exists:!1}}});const d=async()=>{let a=await c.get("/commodity-class/",{params:{query:y.value}});_.value=a.data,C.value.total=a.total,C.value.pageSize=a.total,q()};let D=i([]);const q=async()=>{let a=await c.get("/commodity-class/",{params:{query:{limit:999}}});D.value=a.data.map(e=>({label:e.title,value:e._id}))},M=(a,e)=>e.label.toLowerCase().indexOf(a.toLowerCase())>=0;let B=i({_id:""});const N=()=>{let a=B.value._id;a==""?k.warn("\u672A\u9009\u62E9"):typeof a=="undefined"?(y.value.where={parent:{$exists:!1}},d()):(delete y.value.where.parent,y.value.where=B.value,d())},z=a=>{for(let e in _.value)if(_.value[e].title==a)return _.value[e]._id},L=async a=>await c.get(`/commodity-class/${a}`);let l=i({title:"",parent:""}),s=i({add:!1,edit:!1,addSon:!1});const V=()=>{s.value.add=!0};let w=i("");const P=a=>{s.value.addSon=!0,w.value=a.title,l.value.parent=a._id},T=async()=>{await c.post("commodity-class/addClass",l.value),k.success("\u6DFB\u52A0\u6210\u529F"),d(),F(),s.value.addSon=!1},j=async()=>{l.value.parent==""?delete l.value.parent:l.value.parent=z(l.value.parent),await c.post("commodity-class/addClass",l.value),k.success("\u6DFB\u52A0\u6210\u529F"),d(),s.value.add=!1,F()},F=()=>{l.value={title:"",parent:""}},E=()=>{F(),console.log("cancel")},K=(a,e)=>{ee.confirm({title:"\u662F\u5426\u786E\u8BA4\u5220\u9664\uFF1F",icon:t(te),content:t("div",{style:"color:red"},`\u662F\u5426\u5220\u9664:${e} \u6570\u636E\uFF1F`),async onOk(){await c.delete(`commodity-class/${a._id}`),R(a.children),k.success("\u5DF2\u5220\u9664"),d()},onCancel(){console.log("Cancel"),d()}})},R=async a=>{if(a)for(let e in a){let f=i({title:a[e].title});await c.post(`commodity-class/updata/${a[e]._id}`,f.value)}d()},h=i(""),x=i(""),G=async a=>{x.value="",s.value.edit=!0,w.value=a.title,h.value=a._id,a.parent&&L(a.parent).then(e=>{x.value=e.title})},H=async()=>{await c.post(`commodity-class/updata/${h.value}`,l.value),s.value.edit=!1,F(),d()};return W(()=>{d()}),(a,e)=>{const f=v("a-button"),S=v("a-input"),r=v("a-form-item"),b=v("a-form"),O=v("a-modal"),$=v("a-select"),g=v("a-table-column"),J=v("a-table");return X(),Y(Z,null,[p("div",null,[p("div",ae,[p("div",null,[t(f,{type:"primary",class:"text-black",onClick:V},{default:o(()=>[le]),_:1}),t(O,{visible:n(s).add,"onUpdate:visible":e[2]||(e[2]=u=>n(s).add=u),title:"\u65B0\u589E\u7236\u7C7B",onCancel:E,onOk:j,centered:!0},{default:o(()=>[t(b,{model:n(l),"onUpdate:model":e[1]||(e[1]=u=>U(l)?l.value=u:l=u)},{default:o(()=>[t(r,{label:"\u5206\u7C7B\u540D",name:"title",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u5206\u7C7B\u540D",trigger:"blur"},{min:2,max:10,message:"\u5206\u7C7B\u540D\u957F\u5EA62-10"},{}]},{default:o(()=>[t(S,{value:n(l).title,"onUpdate:value":e[0]||(e[0]=u=>n(l).title=u)},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"])]),p("div",ue,[t(b,{layout:"inline"},{default:o(()=>[t(r,{label:"\u5206\u7C7B",class:"w-44"},{default:o(()=>[t($,{options:n(D),value:n(B)._id,"onUpdate:value":e[3]||(e[3]=u=>n(B)._id=u),allowClear:!0,showSearch:!0,"filter-Option":M},null,8,["options","value"])]),_:1}),t(r,null,{default:o(()=>[t(f,{type:"primary",onClick:N},{default:o(()=>[ne]),_:1})]),_:1})]),_:1})])]),p("div",oe,[t(J,{dataSource:n(_),rowKey:"_id",pagination:n(C)},{default:o(()=>[t(g,{title:"\u7C7B\u522B",dataIndex:"title",key:"title",class:"w-60",align:"center"}),t(g,{title:"id",dataIndex:"_id",key:"_id",align:"center"}),t(g,{title:"\u7236\u7EA7id",dataIndex:"parent",key:"parent",align:"center"}),t(g,{title:"\u64CD\u4F5C",dataIndex:"operation",key:"operation",align:"center"},{default:o(({record:u})=>[p("div",null,[t(f,{type:"link",onClick:I=>P(u)},{default:o(()=>[se]),_:2},1032,["onClick"]),t(f,{type:"link",onClick:I=>G(u)},{default:o(()=>[ie]),_:2},1032,["onClick"]),t(f,{type:"link",onClick:I=>K(u,u.title)},{default:o(()=>[de]),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["dataSource","pagination"])])]),p("div",null,[t(O,{visible:n(s).edit,"onUpdate:visible":e[7]||(e[7]=u=>n(s).edit=u),title:"\u66F4\u6539\u4FE1\u606F",onCancel:E,onOk:H,centered:!0},{default:o(()=>[t(r,{label:"\u5F53\u524D\u5206\u7C7B\u540D"},{default:o(()=>[m(A(n(w)),1)]),_:1}),t(r,{label:"\u5F53\u524D\u7236\u7C7B\u540D"},{default:o(()=>[m(A(x.value),1)]),_:1}),t(b,{model:n(l),"onUpdate:model":e[6]||(e[6]=u=>U(l)?l.value=u:l=u)},{default:o(()=>[t(r,{label:"\u65B0\u5206\u7C7B\u540D",name:"title"},{default:o(()=>[t(S,{value:n(l).title,"onUpdate:value":e[4]||(e[4]=u=>n(l).title=u)},null,8,["value"])]),_:1}),t(r,{label:"\u65B0\u7236\u7EA7\u540D",name:"parent"},{default:o(()=>[t($,{options:n(D),value:n(l).parent,"onUpdate:value":e[5]||(e[5]=u=>n(l).parent=u),allowClear:!0},null,8,["options","value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"])]),p("div",null,[t(O,{visible:n(s).addSon,"onUpdate:visible":e[10]||(e[10]=u=>n(s).addSon=u),title:"\u65B0\u589E\u5B50\u7C7B",onCancel:E,onOk:T,centered:!0},{default:o(()=>[t(b,{model:n(l),"onUpdate:model":e[9]||(e[9]=u=>U(l)?l.value=u:l=u)},{default:o(()=>[t(r,{label:"\u5F53\u524D\u7C7B"},{default:o(()=>[m(A(n(w)),1)]),_:1}),t(r,{label:"\u65B0\u589E\u5206\u7C7B\u540D",name:"title",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u5206\u7C7B\u540D",trigger:"blur"},{min:2,max:10,message:"\u5206\u7C7B\u540D\u957F\u5EA62-10"},{}]},{default:o(()=>[t(S,{value:n(l).title,"onUpdate:value":e[8]||(e[8]=u=>n(l).title=u)},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"])])],64)}}});export{pe as default};
