import{d as V,r as s,o as _,c as D,w as o,h as x,j as i,p as g,g as P,i as l,l as e,F as Q,t as R,n as k}from"./vendor.fd5a6943.js";import{a as W}from"./api.2aedc38d.js";import"./http.7ef13b95.js";import{C as X}from"./crud-api.82cb9041.js";const Y=["src"],Z={key:1},ee=i("div",{class:"ant-upload-text"},"\u70B9\u51FB\u4E0A\u4F20",-1),N=V({props:{imageUrl:String},emits:["on-success"],setup(y,{emit:U}){const r=(f,w,C)=>{U("on-success",f.file.response.url)},A=()=>!0;return(f,w)=>{const C=s("loading-outlined"),I=s("plus-outlined"),p=s("a-upload");return _(),D(p,{name:"file","list-type":"picture-card","show-upload-list":!1,action:"http://localhost:3001/admin/api/upload",onChange:r,"before-upload":A},{default:o(()=>[y.imageUrl?(_(),x("img",{key:0,src:y.imageUrl,alt:"avatar"},null,8,Y)):(_(),x("div",Z,[f.loading?(_(),D(C,{key:0})):(_(),D(I,{key:1})),ee]))]),_:1})}}}),le=i("div",{class:"mb-2 text-2xl"},"\u5546\u94FA\u7BA1\u7406",-1),te={class:"mb-2 flex justify-start"},ue=k(" \u65B0\u589E\u5546\u94FA "),ae={class:"w-full"},oe=k("\u641C\u7D22"),ne={class:"my-5"},se=k("\u4FEE\u6539"),ie=k("\u5220\u9664"),ve=V({setup(y){const{remove:U,viss:r,editOk:A,addOk:f,fetch:w,data:C,query:I,where:p,search:S,pagination:j,pageChange:T}=X("shops");let q=g("addShop");localStorage.getItem("role")==="admin"?p.value={title:"",user:""}:p.value={title:"",user:localStorage.getItem("userid")};let a=g({title:"",user:localStorage.getItem("userid"),description:"",images:"",address:"",phone:""});const K=()=>{a.value={title:"",user:a.value.user,description:"",images:"",address:"",phone:""}},L=()=>{r.value.add=!0};let $=g(!1),c=g([]);const z=async()=>{if(localStorage.getItem("role")==="admin"){const v=await W.user.find({limit:999});c.value=v.data.map(t=>({label:t.username,value:t._id})),$.value=!0}else c.value=[{label:localStorage.getItem("username"),value:localStorage.getItem("userid")}],console.log("\u4E0D\u662Fadmin")},O=()=>{K(),console.log("cancel")};let M=g("");const G=v=>{console.log(v);for(let t in a.value)a.value[t]=v[t];a.value.user=v.user._id,M.value=v._id,r.value.edit=!0};return P(()=>{S(),z()}),(v,t)=>{const b=s("a-button"),d=s("a-input"),n=s("a-form-item"),E=s("a-select"),B=s("a-form"),m=s("a-table-column"),H=s("a-image"),J=s("a-table"),h=s("a-modal");return _(),x(Q,null,[i("div",null,[le,i("div",te,[i("div",null,[l(b,{onClick:L,type:"primary"},{default:o(()=>[ue]),_:1})]),i("div",ae,[l(B,{layout:"inline"},{default:o(()=>[l(n,{label:"\u5E97\u94FA\u540D\uFF1A",class:"w-52"},{default:o(()=>[l(d,{value:e(p).title,"onUpdate:value":t[0]||(t[0]=u=>e(p).title=u)},null,8,["value"])]),_:1}),l(n,{label:"\u6240\u5C5E\u7528\u6237\u540D",class:"w-44"},{default:o(()=>[l(E,{options:e(c),value:e(p).user,"onUpdate:value":t[1]||(t[1]=u=>e(p).user=u),allowClear:e($)},null,8,["options","value","allowClear"])]),_:1}),l(n,null,{default:o(()=>[l(b,{type:"primary",onClick:e(S)},{default:o(()=>[oe]),_:1},8,["onClick"])]),_:1})]),_:1})])]),i("div",ne,[l(J,{dataSource:e(C),rowKey:"title",pagination:e(j),onChange:e(T),scroll:{y:400}},{default:o(()=>[l(m,{title:"\u5546\u94FA\u540D",dataIndex:"title",key:"title",class:"w-60"}),l(m,{title:"id",dataIndex:"_id",key:"_id"}),l(m,{title:"\u6240\u5C5E\u7528\u6237",dataIndex:"user",key:"user"},{default:o(({record:u})=>{var F;return[i("span",null,R((F=u.user)==null?void 0:F.username),1)]}),_:1}),l(m,{title:"\u5546\u94FA\u7B80\u4ECB",dataIndex:"description",key:"description"}),l(m,{title:"\u5546\u94FA\u5934\u50CF",dataIndex:"images",key:"images"},{default:o(({record:u})=>[l(H,{width:70,src:u.images},null,8,["src"])]),_:1}),l(m,{title:"\u5546\u94FA\u5730\u5740",dataIndex:"address",key:"address"}),l(m,{title:"\u5546\u94FA\u7535\u8BDD",dataIndex:"phone",key:"phone"}),l(m,{title:"\u64CD\u4F5C",dataIndex:"operation",key:"operation"},{default:o(({record:u})=>[i("div",null,[l(b,{type:"link",onClick:F=>G(u)},{default:o(()=>[se]),_:2},1032,["onClick"]),l(b,{type:"link",onClick:F=>e(U)(u,u.title)},{default:o(()=>[ie]),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["dataSource","pagination","onChange"])])]),i("div",null,[l(h,{visible:e(r).add,"onUpdate:visible":t[8]||(t[8]=u=>e(r).add=u),title:"\u65B0\u589E\u5546\u94FA",onOk:t[9]||(t[9]=u=>e(f)(e(a),e(q))),afterClose:O},{default:o(()=>[l(B,{model:e(a)},{default:o(()=>[l(n,{label:"\u5546\u5E97\u540D"},{default:o(()=>[l(d,{value:e(a).title,"onUpdate:value":t[2]||(t[2]=u=>e(a).title=u)},null,8,["value"])]),_:1}),l(n,{label:"\u6240\u5C5E\u7528\u6237\u540D"},{default:o(()=>[l(E,{options:e(c),value:e(a).user,"onUpdate:value":t[3]||(t[3]=u=>e(a).user=u)},null,8,["options","value"])]),_:1}),l(n,{label:"\u5546\u94FA\u7B80\u4ECB"},{default:o(()=>[l(d,{value:e(a).description,"onUpdate:value":t[4]||(t[4]=u=>e(a).description=u)},null,8,["value"])]),_:1}),l(n,{label:"\u5546\u94FA\u5934\u50CF"},{default:o(()=>[l(N,{imageUrl:e(a).images,onOnSuccess:t[5]||(t[5]=u=>{e(a).images=u})},null,8,["imageUrl"])]),_:1}),l(n,{label:"\u5546\u94FA\u5730\u5740"},{default:o(()=>[l(d,{value:e(a).address,"onUpdate:value":t[6]||(t[6]=u=>e(a).address=u)},null,8,["value"])]),_:1}),l(n,{label:"\u5546\u94FA\u7535\u8BDD"},{default:o(()=>[l(d,{value:e(a).phone,"onUpdate:value":t[7]||(t[7]=u=>e(a).phone=u)},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"])]),i("div",null,[l(h,{visible:e(r).edit,"onUpdate:visible":t[16]||(t[16]=u=>e(r).edit=u),title:"\u4FEE\u6539\u4FE1\u606F",afterClose:O,onOk:t[17]||(t[17]=u=>e(A)(e(M),e(a)))},{default:o(()=>[l(B,{model:e(a)},{default:o(()=>[l(n,{label:"\u5546\u5E97\u540D"},{default:o(()=>[l(d,{value:e(a).title,"onUpdate:value":t[10]||(t[10]=u=>e(a).title=u)},null,8,["value"])]),_:1}),l(n,{label:"\u6240\u5C5E\u7528\u6237\u540D"},{default:o(()=>[l(E,{options:e(c),value:e(a).user,"onUpdate:value":t[11]||(t[11]=u=>e(a).user=u)},null,8,["options","value"])]),_:1}),l(n,{label:"\u5546\u94FA\u7B80\u4ECB"},{default:o(()=>[l(d,{value:e(a).description,"onUpdate:value":t[12]||(t[12]=u=>e(a).description=u)},null,8,["value"])]),_:1}),l(n,{label:"\u5546\u94FA\u5934\u50CF"},{default:o(()=>[l(N,{imageUrl:e(a).images,onOnSuccess:t[13]||(t[13]=u=>{e(a).images=u})},null,8,["imageUrl"])]),_:1}),l(n,{label:"\u5546\u94FA\u5730\u5740"},{default:o(()=>[l(d,{value:e(a).address,"onUpdate:value":t[14]||(t[14]=u=>e(a).address=u)},null,8,["value"])]),_:1}),l(n,{label:"\u5546\u94FA\u7535\u8BDD"},{default:o(()=>[l(d,{value:e(a).phone,"onUpdate:value":t[15]||(t[15]=u=>e(a).phone=u)},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"])])],64)}}});export{ve as default};
