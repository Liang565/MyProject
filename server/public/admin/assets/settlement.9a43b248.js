import{h as D}from"./http.72fb258c.js";import{d as S,o as X,r as b,b as f,c as w,e,G as C,f as l,h as P,F as Q,g as Y,w as r,H as B,v as ee,u as te}from"./user.dc7ceeb0.js";import{_ as I}from"./iconPark.57ea052f.js";import{T as k,w as R,h as q}from"./http.b40e557a.js";import{q as d,V as u,X as m,a as j}from"./reactivity.esm-bundler.f180a2dc.js";import{a as se}from"./index.esm.774e7b25.js";import{D as oe}from"./function-call.a2ba94a4.js";import"./vendor.21c9141e.js";import"./api.491a85e5.js";import"./admin-store.0a078265.js";import"./crud-api.fca6ec91.js";import"./index.550ade87.js";import"./use-route.bed03084.js";const ue={class:"w-90vw"},le={class:"flex justify-center items-center pt-5"},ne={key:0},ae={key:1},ie=S({props:{type:String,addressObject:Object},emits:["end"],setup(L,{emit:$}){const s=L;let p=d({});const o=async n=>{console.log(n);const E=d({name:n.name,province:n.province,city:n.city,county:n.county,address:n.addressDetail,tel:n.tel,postalCode:n.areaCode,isDefault:n.isDefault});s.type=="add"?(console.log(E.value),await D.post("user-info",E.value),k.success("\u65B0\u589E\u6210\u529F~"),$("end",!1)):s.type=="edit"&&s.addressObject&&(await D.put(`user-info/${s.addressObject._id}`,E.value),k.success("\u4FEE\u6539\u6210\u529F~"),$("end",!1))};return X(()=>{s.type==="edit"&&s.addressObject&&(console.log(s.addressObject),p.value={name:s.addressObject.name,province:s.addressObject.province,city:s.addressObject.city,county:s.addressObject.county,addressDetail:s.addressObject.address,tel:s.addressObject.tel,postalCode:s.addressObject.postalCode,areaCode:s.addressObject.postalCode,isDefault:s.addressObject.isDefault})}),(n,E)=>{const h=b("van-address-edit");return f(),w("div",ue,[e("div",le,[s.type=="add"?(f(),w("div",ne,"\u65B0\u589E\u5730\u5740")):C("",!0),s.type=="edit"?(f(),w("div",ae,"\u4FEE\u6539\u5730\u5740")):C("",!0)]),e("div",null,[l(h,{"address-info":u(p),"area-list":u(se),"show-postal":"","show-set-default":"","show-search-result":"","area-columns-placeholder":["\u8BF7\u9009\u62E9","\u8BF7\u9009\u62E9","\u8BF7\u9009\u62E9"],onSave:o},null,8,["address-info","area-list"])])])}}}),de={class:"bg-gray-100 p-0 w-100vw h-100vh"},ce={class:"flex justify-between items-center pt-2"},re=e("div",{class:"mr-5 ml-2 flex justify-between items-center"},[e("div")],-1),pe=e("div",{class:"pl-3"},"\u6211\u7684\u6536\u8D27\u5730\u5740",-1),_e={class:"w-16 h-7"},me={key:1},ve={class:"rounded flex justify-center pb-20"},fe={class:"w-full"},he=["onClick"],ye={class:"flex justify-start items-center"},we={class:"custom-title"},ke={class:"text-lg"},ge={key:0},be=B("\u9ED8\u8BA4"),Fe=["onClick"],Ee={class:"flex justify-between items-center"},xe={class:"flex items-center"},$e=["onClick"],Ce=e("div",{class:"text-sm"},"\u9ED8\u8BA4\u5730\u5740",-1),De=["onClick"],je=e("div",{class:"text-sm"},"\u5220\u9664",-1),Be=[je],Ae={class:"flex justify-between items-center pl-3 p-3 w-full fixed bottom-0 bg-white"},Oe=B(" \u6DFB\u52A0\u5730\u5740 "),Ie={key:0,class:"h-80vh"},Le=S({emits:["selectMyInfo"],setup(L,{emit:$}){const s=g=>{k.success("\u9009\u62E9\u6210\u529F~"),$("selectMyInfo",g)};let p=d([]);const o=async()=>{const g=await q.post("user-info/find");p.value=g,p.value.length===0&&k.fail("\u65E0\u6570\u636E~")};let n=d(!0);const E=()=>{n.value=!n.value};d({isDefault:!0});const h=async g=>{k.loading("~"),setTimeout(async()=>{await q.put(`user-info/${g}`,{isDefault:!0}),o()},1e3)},_=g=>{oe.confirm({title:"\u786E\u5B9A\u8981\u5220\u9664\u8BE5\u5730\u5740\u5417\uFF1F",cancelButtonText:"\u6211\u518D\u60F3\u60F3"}).then(async()=>{setTimeout(async()=>{await q.delete(`user-info/${g}`),o(),k.success("\u5DF2\u5220\u9664~")},1e3)}).catch(()=>{})};let c=d(!1);const F=()=>{c.value=!c.value,V.value="add"};let A=d({}),V=d();const G=g=>{c.value=!c.value,V.value="edit",A.value=g},z=()=>{N&&o()};let N=localStorage.getItem("token");return X(()=>{N&&o()}),(g,y)=>{const x=b("van-tag"),O=b("van-cell"),U=b("van-cell-group"),T=b("van-button"),W=b("van-popup");return f(),w("div",null,[e("div",de,[e("div",ce,[re,pe,e("div",_e,[e("button",{onClick:E},[u(n)?(f(),P(I,{key:0,type:"edit-two",theme:"outline",size:"24",spin:!1,fill:"#000000",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2})):C("",!0),u(n)?C("",!0):(f(),w("span",me,"\u5B8C\u6210"))])])]),e("div",ve,[e("div",fe,[(f(!0),w(Q,null,Y(u(p),t=>(f(),w("div",{class:"py-1",onClick:i=>s(t)},[l(U,{inset:""},{default:r(()=>[l(O,null,{title:r(()=>[e("div",ye,[e("div",we,[e("span",ke,m(t.name),1),e("span",null,m(t.tel),1)]),t.isDefault?(f(),w("div",ge,[l(x,{round:"",type:"danger"},{default:r(()=>[be]),_:1})])):C("",!0)])]),label:r(()=>[e("div",null,m(t.province)+"/ "+m(t.city)+"/ "+m(t.county)+"/ "+m(t.address),1)]),"right-icon":r(()=>[e("button",{onClick:R(i=>G(t),["stop"])},[u(n)?(f(),P(I,{key:0,type:"edit",theme:"outline",size:"20  ",spin:!1,fill:"#000000",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2})):C("",!0)],8,Fe)]),_:2},1024),u(n)?C("",!0):(f(),P(O,{key:0},{default:r(()=>[e("div",Ee,[e("div",xe,[e("div",null,[e("button",{onClick:R(i=>h(t._id),["stop"])},[l(I,{type:"round",theme:"outline",size:"18",spin:!1,fill:"#000000",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2})],8,$e)]),Ce]),e("div",null,[e("button",{onClick:R(i=>_(t._id),["stop"])},Be,8,De)])])]),_:2},1024))]),_:2},1024)],8,he))),256))])]),e("div",Ae,[l(T,{type:"primary",size:"large",icon:"plus",round:"",onClick:F},{default:r(()=>[Oe]),_:1})])]),e("div",null,[l(W,{round:"",closeable:!0,show:u(c),"onUpdate:show":y[1]||(y[1]=t=>j(c)?c.value=t:c=t),position:"bottom",onClose:y[2]||(y[2]=t=>z())},{default:r(()=>[u(c)?(f(),w("div",Ie,[l(ie,{type:u(V),addressObject:u(A),onEnd:y[0]||(y[0]=t=>{j(c)?c.value=t:c=t})},null,8,["type","addressObject"])])):C("",!0)]),_:1},8,["show"])])])}}}),Ve={class:"flex justify-between w-90vw bg-gray-50 p-3 rounded-lg"},Ne={class:"flex items-center"},Te={class:"text-base"},Se={class:"pr-2"},ze={class:"flex items-center"},Ue=S({emits:["selectInfo"],setup(L,{emit:$}){let s=d({address:"",city:"",county:"",id:"",isDefault:!0,name:"",postalCode:"",province:"",tel:"",user:"",_id:""}),p=d(!1);const o=()=>{$("selectInfo",s.value)},n=()=>{p.value=!0};return(async()=>{const h=await D.post("user-info/find");for(let _ in h)if(h[_].isDefault){s.value=h[_];return}k.fail("\u65E0\u6570\u636E~")})(),ee(s,(h,_)=>{o()}),(h,_)=>{const c=b("van-action-sheet");return f(),w("div",null,[e("div",{class:"flex justify-center py-3",onClick:n},[e("div",Ve,[e("div",Ne,[l(I,{type:"local-two",theme:"filled",size:"35",spin:!1,fill:"#4a90e2",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2})]),e("div",null,[e("div",Te,m(u(s).province)+"/ "+m(u(s).city)+"/ "+m(u(s).county)+"/ "+m(u(s).address),1),e("div",null,[e("span",Se,m(u(s).name),1),e("span",null,m(u(s).tel),1)])]),e("div",ze,[l(I,{type:"right",theme:"outline",size:"24",spin:!1,fill:"#000000",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2})])])]),e("div",null,[l(c,{show:u(p),"onUpdate:show":_[1]||(_[1]=F=>j(p)?p.value=F:p=F),title:"\u9009\u62E9\u5730\u5740"},{default:r(()=>[l(Le,{onSelectMyInfo:_[0]||(_[0]=F=>{j(s)?s.value=F:s=F})})]),_:1},8,["show"])])])}}}),We=B(" \u786E\u8BA4\u8BA2\u5355 "),Me={class:"pb-16"},Pe={class:"flex justify-center"},Re={class:"w-90vw mb-3 bg-gray-100 rounded-lg"},qe={class:"text-xl w-40 overflow-hidden text-ellipsis whitespace-nowrap"},Ge={class:"w-44 overflow-hidden text-ellipsis whitespace-nowrap"},He={class:"flex justify-end items-center pl-3 p-3 w-full fixed bottom-0 bg-white"},Je={class:"flex items-center mx-2"},Ke={class:"text-sm text-neutral-600"},Xe=B(" \u5408\u8BA1\uFF1A "),Qe={class:"text-red-500"},Ye={class:"ml-3"},Ze=B("\u63D0\u4EA4\u8BA2\u5355"),et={class:"h-70vh bg-gray-50 py-5"},tt={class:"flex justify-center pb-20 pt-40"},st={class:"w-80vw"},ot=B("\u786E\u5B9A"),ut={class:"h-70vh bg-gray-50 py-5"},lt=B(" \u6CA1\u6709\u63A5\u652F\u4ED8\u5B9D\u6C99\u76D2\uFF0C\u751F\u6210\u7684\u8BA2\u5355\u72B6\u6001\u90FD\u662F\u672A\u652F\u4ED8\u7684\u3002 \u76F4\u63A5\u70B9\u51FB\u786E\u5B9A\u3002 "),nt={class:"flex justify-center pb-20 pt-40"},at={class:"w-80vw"},it=B("\u786E\u5B9A"),bt=S({props:{model:{type:String,default:"1"}},setup(L){const $=L,s=te();let p=d(),o=d([]),n=d(0),E=d(0),h=d(),_=d(!1),c=d(!1),F=d([]),A=!1;const V=()=>{s.go(-1)};p.value=JSON.parse($.model),n.value=p.value.total,c.value=p.value.key==="cart",(async t=>{E.value=t.length;for(let i in t){const v=await D.get(`commoditys/${t[i].commodity}`);c.value?o.value.push({id:v._id,image:v.image[0].url,name:v.commodityName,introduce:v.commodityIntroduce,price:v.price,kucun:v.commodityNum,num:t[i].goodsNum,remarks:"",key:i,cartId:t[i].cartId,shop:v.shop}):o.value.push({id:v._id,image:v.image[0].url,name:v.commodityName,introduce:v.commodityIntroduce,price:v.price,kucun:v.commodityNum,num:t[i].goodsNum,remarks:"",key:i,shop:v.shop})}})(p.value.model);const z=()=>{k.loading({message:"\u52A0\u8F7D\u4E2D...",forbidClick:!0}),setTimeout(async()=>{for(let t in o.value){const i=await D.post("orders",{user:h.value.user,commodity:o.value[t].id,goodsNum:o.value[t].num,money:o.value[t].num*o.value[t].price,userInfo:h.value.id,remarks:o.value[t].remarks,state:"\u672A\u652F\u4ED8",shop:o.value[t].shop});F.value.push(i._id),c.value&&await D.delete(`shopping-cart/${o.value[t].cartId}`),await D.put(`commoditys/${o.value[t].id}`,{commodityNum:o.value[t].kucun-o.value[t].num})}k.success("\u521B\u5EFA\u8BA2\u5355\u6210\u529F~"),console.log("\u63D0\u4EA4"),A=!1,_.value=!0},2e3)},N=()=>{k.loading({message:"\u52A0\u8F7D\u4E2D...",forbidClick:!0}),setTimeout(async()=>{for(let t in F.value)await D.put(`/orders/${F.value[t]}`,{state:"\u5F85\u53D1\u8D27"});k.success("\u652F\u4ED8\u6210\u529F~"),A=!0,_.value=!1},2e3)},g=()=>{A?(k.success("\u652F\u4ED8\u6210\u529F~"),s.go(-1)):(k.fail("\u672A\u652F\u4ED8~"),s.push("/my/pending"))};let y=d(!1),x=d(""),O=d("");const U=t=>{y.value=!0,x.value=t.remarks,O.value=t.key},T=()=>{x.value="",O.value=""},W=()=>{o.value[O.value].remarks=x.value,y.value=!1,T()};return(t,i)=>{const v=b("van-card"),H=b("van-field"),M=b("van-button"),Z=b("van-cell-group"),J=b("van-action-sheet");return f(),w("div",null,[e("div",null,[e("button",{onClick:V,class:"flex items-center pl-5 pt-2"},[l(I,{type:"back",theme:"outline",size:"24",spin:!1,fill:"#000000",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2}),We])]),e("div",Me,[e("div",null,[l(Ue,{onSelectInfo:i[0]||(i[0]=a=>{j(h)?h.value=a:h=a})})]),(f(!0),w(Q,null,Y(u(o),a=>(f(),w("div",Pe,[e("div",Re,[l(v,{num:a.num,price:a.price,thumb:a.image,class:"rounded-t-lg"},{title:r(()=>[e("div",qe,m(a.name),1)]),desc:r(()=>[e("div",Ge,m(a.introduce),1)]),footer:r(()=>[e("div",null,"\u5408\u8BA1\uFFE5"+m(a.price*a.num),1)]),_:2},1032,["num","price","thumb"]),l(H,{modelValue:a.remarks,"onUpdate:modelValue":K=>a.remarks=K,label:"\u8BA2\u5355\u5907\u6CE8\uFF1A",readonly:"",placeholder:"\u65E0\u5907\u6CE8","right-icon":"arrow",onClick:K=>U(a),class:"mb-1"},null,8,["modelValue","onUpdate:modelValue","onClick"])])]))),256))]),e("div",He,[e("div",Je,[e("div",null,[e("span",Ke,"\u5171\u8BA1"+m(u(E))+"\u4EF6",1),Xe,e("span",Qe,"\uFFE5"+m(u(n)),1)]),e("div",Ye,[l(M,{round:"",type:"primary",onClick:z},{default:r(()=>[Ze]),_:1})])])]),e("div",null,[l(J,{show:u(y),"onUpdate:show":i[2]||(i[2]=a=>j(y)?y.value=a:y=a),title:"\u8BA2\u5355\u5907\u6CE8",onClose:T},{default:r(()=>[e("div",et,[l(Z,{inset:""},{default:r(()=>[l(H,{modelValue:u(x),"onUpdate:modelValue":i[1]||(i[1]=a=>j(x)?x.value=a:x=a),rows:"5",autosize:"",type:"textarea",maxlength:"200",placeholder:"\u8BF7\u8F93\u5165\u7559\u8A00","show-word-limit":""},null,8,["modelValue"])]),_:1}),e("div",tt,[e("div",st,[l(M,{plain:"",type:"primary",size:"large",onClick:W},{default:r(()=>[ot]),_:1})])])])]),_:1},8,["show"])]),e("div",null,[l(J,{show:u(_),"onUpdate:show":i[3]||(i[3]=a=>j(_)?_.value=a:_=a),title:"\u652F\u4ED8",onClose:g},{default:r(()=>[e("div",ut,[lt,e("div",nt,[e("div",at,[l(M,{plain:"",type:"primary",size:"large",onClick:N},{default:r(()=>[it]),_:1})])])])]),_:1},8,["show"])])])}}});export{bt as default};
