import{T as r,w as S}from"./function-call.b3f16382.js";import{d as Z,u as ee,v as te,o as oe,a as se,r as g,b as s,c,e as t,f as i,G as n,h as C,w as d,H as F,F as ue,g as le}from"./user.0f0244cd.js";import{C as ie}from"./curd.4b441baa.js";import{h as $}from"./http.2cf225b3.js";import{_ as y}from"./iconPark.1cfb687a.js";import"./vue-types.m.1da1f69a.js";import{_ as ne}from"./loginDialog.db630545.js";import{q as p,V as e,X as v,a as A,n as ae}from"./reactivity.esm-bundler.f180a2dc.js";import"./vendor.1e3ef9c3.js";import"./http.3d895303.js";import"./api.e2fff66e.js";import"./admin-store.fe4adc91.js";import"./crud-api.b919ecb7.js";import"./index.016760bd.js";import"./function-call.481ffa2f.js";import"./use-route.2456c025.js";const re={class:"flex justify-between mb-5 ml-5 mt-2"},ce={class:"flex w-16"},de={key:0,class:"mr-2"},me={key:1},_e={class:"text-xl"},pe=F(" \u8D2D\u7269\u8F66"),fe={key:0},he={class:"w-16 h-7"},ve={key:1},ke={class:"pb-28"},ge={class:"w-90vw"},ye={class:"text-xl w-40 overflow-hidden text-ellipsis whitespace-nowrap"},Fe={key:0,class:"text-red-500"},xe={class:"w-40 overflow-hidden text-ellipsis whitespace-nowrap"},we={class:"flex"},Ce=t("div",{class:"text-sm mt-1"},"\u5168\u9009",-1),be={key:0,class:"flex items-center mx-2"},De={class:"text-sm"},Ee=F(" \u5408\u8BA1\uFF1A "),Be=t("span",{class:"text-sm text-red-500"}," \uFFE5 ",-1),Ne={class:"text-xl text-red-500"},Ae={class:"ml-3"},Le=F("\u7ED3\u7B97"),je={key:1,class:"flex items-center"},Ve=F(" \u5DF2\u9009\uFF1A"),ze={class:"mx-2"},Ge=F("\u5220\u9664"),et=Z({setup(Se){let x=localStorage.getItem("token");const b=ee();let w=p(!1);const{fetch:D,search:$e,data:L,query:E,goGoods:T,total:j,totalSum:W,removeCart:V}=ie("shopping-cart"),q=async l=>{l.commodity.commodityNum<l.goodsNum?r.fail("\u5E93\u5B58\u4E0D\u8DB3~"):l.goodsNum===1?r.fail("\u5546\u54C1\u4E0D\u80FD\u518D\u51CF\u5C11\u4E86~"):(r.loading({message:"\u52A0\u8F7D\u4E2D...",forbidClick:!0,duration:500}),$.put(`shopping-cart/${l._id}`,{goodsNum:l.goodsNum-1}),setTimeout(()=>{E.value.where={user:k},D()},500))},I=async l=>{r.loading({message:"\u52A0\u8F7D\u4E2D...",forbidClick:!0,duration:500}),l.commodity.commodityNum<l.goodsNum?r.fail("\u5E93\u5B58\u4E0D\u8DB3~"):($.put(`shopping-cart/${l._id}`,{goodsNum:l.goodsNum+1}),setTimeout(()=>{E.value.where={user:k},D()},500))},M=()=>{b.go(-2)},R=()=>{b.push("/")};let h=p(!0);const U=()=>{x?(h.value=!h.value,u.value=[]):r.fail("\u5F53\u524D\u8EAB\u4EFD\u4E3A\u6E38\u5BA2\uFF0C\u8BF7\u767B\u5F55\uFF01")};let u=p([]),f=p(!1);const z=p();let B=p(0),G=p([]),H="flex justify-between items-center pl-3 p-3 w-full fixed bottom-12 bg-white",O="flex justify-between items-center pl-3 p-3 w-full fixed bottom-0 bg-white",k=localStorage.getItem("userid"),m=p(!1);const J=()=>{if(!x){r.fail("\u5F53\u524D\u8EAB\u4EFD\u4E3A\u6E38\u5BA2\uFF0C\u8BF7\u767B\u5F55\uFF01");return}f.value=!f.value,z.value.toggleAll(f.value)};te(u,(l,a)=>{W(u.value).then(_=>{B.value=_.totalSum,G.value=_.goodsOrder}),u.value.length==L.value.length?f.value=!0:f.value=!1});const X=()=>{if(!x){r.fail("\u5F53\u524D\u8EAB\u4EFD\u4E3A\u6E38\u5BA2\uFF0C\u8BF7\u767B\u5F55\uFF01");return}if(u.value.length===0){r.fail("\u6CA1\u6709\u9009\u62E9\u5546\u54C1~");return}b.push({path:"/settlement",query:{model:JSON.stringify(G.value),total:B.value,key:"cart"}})};return oe(()=>{x?(E.value.where={user:k},D(),se().meta.key=="cart1"&&(w.value=!0)):m.value=!0}),(l,a)=>{const _=g("van-button"),K=g("van-card"),P=g("van-swipe-cell"),Q=g("van-checkbox"),Y=g("van-checkbox-group");return s(),c("div",null,[t("div",re,[t("div",ce,[e(w)?(s(),c("div",de,[t("button",{onClick:M},[i(y,{type:"back",theme:"outline",size:"24",spin:!1,fill:"#000000",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2})])])):n("",!0),e(w)?(s(),c("div",me,[t("button",{onClick:R},[i(y,{type:"home",theme:"outline",size:"24",spin:!1,fill:"#000000",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2})])])):n("",!0)]),t("div",_e,[pe,e(j)?(s(),c("span",fe,"("+v(e(j))+")",1)):n("",!0)]),t("div",he,[t("button",{onClick:U},[e(h)?(s(),C(y,{key:0,type:"edit-two",theme:"outline",size:"24",spin:!1,fill:"#000000",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2})):n("",!0),e(h)?n("",!0):(s(),c("span",ve,"\u5B8C\u6210"))])])]),t("div",ke,[i(Y,{modelValue:e(u),"onUpdate:modelValue":a[0]||(a[0]=o=>A(u)?u.value=o:u=o),ref_key:"checkboxGroup",ref:z,class:"flex justify-center"},{default:d(()=>[t("div",ge,[(s(!0),c(ue,null,le(e(L),o=>(s(),C(Q,{name:o._id,class:"bg-gray-50 rounded-lg flex justify-between mb-3"},{default:d(()=>[i(P,null,{right:d(()=>[i(_,{square:"",text:"\u5220\u9664",type:"danger",class:"delete-button",onClick:N=>e(V)([o._id],e(k))},null,8,["onClick"])]),default:d(()=>[i(K,{num:o.goodsNum,price:o.goodsNum*o.commodity.price,thumb:o.commodity.image[0].url,onClick:N=>e(T)(o.commodity)},{title:d(()=>[t("div",ye,v(o.commodity.commodityName),1)]),desc:d(()=>[o.commodity.commodityNum<o.goodsNum?(s(),c("div",Fe," \u5E93\u5B58\u4E0D\u8DB3 ")):n("",!0),t("div",xe,v(o.commodity.commodityIntroduce),1)]),footer:d(()=>[i(_,{size:"small",icon:"minus",color:"rgb(59, 130, 246)",onClick:S(N=>q(o),["stop"])},null,8,["onClick"]),i(_,{size:"small",icon:"plus",color:"rgb(59, 130, 246)",onClick:S(N=>I(o),["stop"])},null,8,["onClick"])]),_:2},1032,["num","price","thumb","onClick"])]),_:2},1024)]),_:2},1032,["name"]))),256))])]),_:1},8,["modelValue"])]),t("div",{class:ae(e(w)?e(O):e(H))},[t("div",null,[t("button",{onClick:J},[t("div",we,[e(f)?n("",!0):(s(),C(y,{key:0,type:"full-selection",theme:"outline",size:"24",spin:!1,fill:"#000000",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2})),e(f)?(s(),C(y,{key:1,type:"full-selection",theme:"filled",size:"24",spin:!1,fill:"#4a90e2",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2})):n("",!0),Ce])])]),e(h)?(s(),c("div",be,[t("div",null,[t("span",De," \u5DF2\u9009\uFF1A"+v(e(u).length),1),Ee,Be,t("span",Ne,v(e(B)),1)]),t("div",Ae,[i(_,{round:"",type:"primary",onClick:X},{default:d(()=>[Le]),_:1})])])):n("",!0),e(h)?n("",!0):(s(),c("div",je,[t("div",null,[Ve,t("span",null,v(e(u).length),1)]),t("div",ze,[i(_,{round:"",type:"primary",onClick:a[1]||(a[1]=o=>e(V)(e(u),e(k)))},{default:d(()=>[Ge]),_:1})])]))],2),t("div",null,[i(ne,{showDialog:e(m),"onUpdate:showDialog":a[2]||(a[2]=o=>A(m)?m.value=o:m=o),onGetShow:a[3]||(a[3]=o=>{A(m)?m.value=o:m=o})},null,8,["showDialog"])])])}}});export{et as default};
