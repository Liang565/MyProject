import{h as v}from"./http.fc6e7509.js";import{d as Q,h as i,j as R,r as p,o as W,k as X,p as c,l as e,w as u,u as l,F as Y,m as g,y as _,v as O,D as Z,E as ee}from"./vendor.ce4e530f.js";const te=c("div",{class:"text-2xl"},"\u5206\u7C7B\u7BA1\u7406",-1),ae={class:"mt-2 flex"},le=_("\u65B0\u589E"),ue={class:"ml-5"},ne=_("\u641C\u7D22"),oe={class:"mt-4"},se=_("\u65B0\u589E\u5B50\u7C7B"),ie=_("\u4FEE\u6539"),de=_("\u5220\u9664"),pe=Q({setup(re){let f=i();i([{}]);let y=i({total:999,current:1,pageSize:999}),B=i({limit:y.value.pageSize,page:1,where:{parent:{$exists:!1}}});const d=async()=>{let a=await v.get("/commodity-class/",{params:{query:B.value}});f.value=a.data,y.value.total=a.total,y.value.pageSize=a.total,I()};let k=i([]);const I=async()=>{let a=await v.get("/commodity-class/",{params:{query:{limit:999}}});k.value=a.data.map(t=>({label:t.title,value:t._id}))},q=(a,t)=>t.label.toLowerCase().indexOf(a.toLowerCase())>=0;let C=i({_id:""});const M=()=>{C.value._id==""?g.warn("\u672A\u9009\u62E9"):typeof C.value._id=="undefined"?(B.value.where={parent:{$exists:!1}},d()):(delete B.value.where.parent,B.value.where=C.value,d())},N=a=>{for(let t in f.value)if(f.value[t].title==a)return f.value[t]._id},z=async a=>await v.get(`/commodity-class/${a}`);let n=i({title:"",parent:""}),s=i({add:!1,edit:!1,addSon:!1});const V=()=>{s.value.add=!0};let F=i("");const L=a=>{s.value.addSon=!0,F.value=a.title,n.value.parent=a._id},P=async()=>{await v.post("commodity-class/addClass",n.value),g.success("\u6DFB\u52A0\u6210\u529F"),d(),s.value.addSon=!1},T=async()=>{n.value.parent==""?delete n.value.parent:n.value.parent=N(n.value.parent),await v.post("commodity-class/addClass",n.value),g.success("\u6DFB\u52A0\u6210\u529F"),d(),s.value.add=!1,D()},D=()=>{n.value={title:"",parent:""}},x=()=>{D(),console.log("cancel")},j=(a,t)=>{Z.confirm({title:"\u662F\u5426\u786E\u8BA4\u5220\u9664\uFF1F",icon:e(ee),content:e("div",{style:"color:red"},`\u662F\u5426\u5220\u9664:${t} \u6570\u636E\uFF1F`),async onOk(){await v.delete(`commodity-class/${a._id}`),K(a.children),g.success("\u5DF2\u5220\u9664"),d()},onCancel(){console.log("Cancel"),d()}})},K=async a=>{if(a)for(let t in a){let m=i({title:a[t].title});await v.post(`commodity-class/updata/${a[t]._id}`,m.value)}d()},$=i(""),E=i(""),G=async a=>{E.value="",s.value.edit=!0,F.value=a.title,$.value=a._id,a.parent&&z(a.parent).then(t=>{E.value=t.title})},H=async()=>{await v.post(`commodity-class/updata/${$.value}`,n.value),s.value.edit=!1,D(),d()};return R(()=>{d()}),(a,t)=>{const m=p("a-button"),S=p("a-input"),r=p("a-form-item"),b=p("a-form"),h=p("a-modal"),A=p("a-select"),w=p("a-table-column"),J=p("a-table");return W(),X(Y,null,[c("div",null,[te,c("div",ae,[c("div",null,[e(m,{type:"primary",class:"text-black",onClick:V},{default:u(()=>[le]),_:1}),e(h,{visible:l(s).add,"onUpdate:visible":t[1]||(t[1]=o=>l(s).add=o),title:"\u65B0\u589E\u7236\u7C7B",onCancel:x,onOk:T,centered:!0},{default:u(()=>[e(b,{model:l(n)},{default:u(()=>[e(r,{label:"\u5206\u7C7B\u540D",name:"title",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u5206\u7C7B\u540D",trigger:"blur"},{min:2,max:10,message:"\u5206\u7C7B\u540D\u957F\u5EA62-10"},{}]},{default:u(()=>[e(S,{value:l(n).title,"onUpdate:value":t[0]||(t[0]=o=>l(n).title=o)},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"])]),c("div",ue,[e(b,{layout:"inline"},{default:u(()=>[e(r,{label:"\u5206\u7C7B",class:"w-44"},{default:u(()=>[e(A,{options:l(k),value:l(C)._id,"onUpdate:value":t[2]||(t[2]=o=>l(C)._id=o),allowClear:!0,showSearch:!0,"filter-Option":q},null,8,["options","value"])]),_:1}),e(r,null,{default:u(()=>[e(m,{type:"primary",onClick:M},{default:u(()=>[ne]),_:1})]),_:1})]),_:1})])]),c("div",oe,[e(J,{dataSource:l(f),rowKey:"_id",scroll:{y:400},class:"h-400",pagination:l(y)},{default:u(()=>[e(w,{title:"\u7C7B\u522B",dataIndex:"title",key:"title",class:"w-60",align:"center"}),e(w,{title:"id",dataIndex:"_id",key:"_id",align:"center"}),e(w,{title:"\u7236\u7EA7id",dataIndex:"parent",key:"parent",align:"center"}),e(w,{title:"\u64CD\u4F5C",dataIndex:"operation",key:"operation",align:"center"},{default:u(({record:o})=>[c("div",null,[e(m,{type:"link",onClick:U=>L(o)},{default:u(()=>[se]),_:2},1032,["onClick"]),e(m,{type:"link",onClick:U=>G(o)},{default:u(()=>[ie]),_:2},1032,["onClick"]),e(m,{type:"link",onClick:U=>j(o,o.title)},{default:u(()=>[de]),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["dataSource","pagination"])])]),c("div",null,[e(h,{visible:l(s).edit,"onUpdate:visible":t[5]||(t[5]=o=>l(s).edit=o),title:"\u66F4\u6539\u4FE1\u606F",onCancel:x,onOk:H,centered:!0},{default:u(()=>[e(r,{label:"\u5F53\u524D\u5206\u7C7B\u540D"},{default:u(()=>[_(O(l(F)),1)]),_:1}),e(r,{label:"\u5F53\u524D\u7236\u7C7B\u540D"},{default:u(()=>[_(O(E.value),1)]),_:1}),e(b,{model:l(n)},{default:u(()=>[e(r,{label:"\u65B0\u5206\u7C7B\u540D",name:"title"},{default:u(()=>[e(S,{value:l(n).title,"onUpdate:value":t[3]||(t[3]=o=>l(n).title=o)},null,8,["value"])]),_:1}),e(r,{label:"\u65B0\u7236\u7EA7\u540D",name:"parent"},{default:u(()=>[e(A,{options:l(k),value:l(n).parent,"onUpdate:value":t[4]||(t[4]=o=>l(n).parent=o),allowClear:!0},null,8,["options","value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"])]),c("div",null,[e(h,{visible:l(s).addSon,"onUpdate:visible":t[7]||(t[7]=o=>l(s).addSon=o),title:"\u65B0\u589E\u5B50\u7C7B",onCancel:x,onOk:P,centered:!0},{default:u(()=>[e(b,{model:l(n)},{default:u(()=>[e(r,{label:"\u5F53\u524D\u7C7B"},{default:u(()=>[_(O(l(F)),1)]),_:1}),e(r,{label:"\u65B0\u589E\u5206\u7C7B\u540D",name:"title",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u5206\u7C7B\u540D",trigger:"blur"},{min:2,max:10,message:"\u5206\u7C7B\u540D\u957F\u5EA62-10"},{}]},{default:u(()=>[e(S,{value:l(n).title,"onUpdate:value":t[6]||(t[6]=o=>l(n).title=o)},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"])])],64)}}});export{pe as default};
